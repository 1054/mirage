# We set the language to c because python isn't supported on the MacOS X nodes
# on Travis. However, the language ends up being irrelevant anyway, since we
# install Python ourselves using conda.
language: c

compiler: gcc

os:
    - linux

# Setting sudo to false opts in to Travis-CI container-based builds.
sudo: false

env:
    global:
        - PYTHON_VERSION=3.6
        - EVENT_TYPE='push pull_request'
        - MIRAGE_DATA='non_existing_path'

    matrix:
        - SCRIPT_CMD='pip install -e .'
        - SCRIPT_CMD='pytest -s ./tests/'

#matrix:
#
#    # Don't wait for allowed failures
#    fast_finish: true
#
#    include:
#        # build sphinx documentation with warnings
#        - os: linux
#          env: SETUP_CMD='build_sphinx'
#               CONDA_DEPENDENCIES=$CONDA_DEPENDENCIES
#               PIP_DEPENDENCIES='sphinx_rtd_theme stsci_rtd_theme sphinx-automodapi'
#
#        # PEP8 check with flake8 (only once, i.e. "os: linux")
#        - os: linux
#          env: MAIN_CMD='flake8 --count'
#               SETUP_CMD='mirage'
#               CONDA_DEPENDENCIES=$CONDA_DEPENDENCIES
#
#    allow_failures:
#        # PEP8 will fail for numerous reasons. Ignore it.
#        - env: MAIN_CMD='flake8 --count'
#               SETUP_CMD='mirage'
#               CONDA_DEPENDENCIES=$CONDA_DEPENDENCIES

before_install:
    - git clone git://github.com/astropy/ci-helpers.git
    - source ci-helpers/travis/setup_conda_$TRAVIS_OS_NAME.sh

install:
    - conda env create --yes -n mirage_$TRAVIS_OS_NAME python=$PYTHON_VERSION -f=mirage_environment_$TRAVIS_OS_NAME.yml
    - source activate mirage_$TRAVIS_OS_NAME

script:
    - $SCRIPT_CMD
