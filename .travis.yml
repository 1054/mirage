# We set the language to c because python isn't supported on the MacOS X nodes
# on Travis. However, the language ends up being irrelevant anyway, since we
# install Python ourselves using conda.
language: c

compiler: gcc

# Setting sudo to false opts in to Travis-CI container-based builds.
sudo: false

env:
    global:
        - PYTHON_VERSION=3.6
        - EVENT_TYPE='push pull_request'
        - MIRAGE_DATA='non_existing_path'

matrix:
    include:
        # Run pytest suite
        - name: test linux
          os: linux

        # Run pytest suite
        - name: test osx
          os: osx
          osx_image: xcode10.2

before_install:
    - git clone git://github.com/astropy/ci-helpers.git
    - source ci-helpers/travis/setup_conda_$TRAVIS_OS_NAME.sh

install:
    - conda config â€“set channel_priority strict # Hopefully make conda run faster
    - conda create -n mirage python=$PYTHON_VERSION
    - conda env update -n mirage -f=environment.yml
    - source activate mirage
    - pip install -e .

script:
    - pytest ./tests/
